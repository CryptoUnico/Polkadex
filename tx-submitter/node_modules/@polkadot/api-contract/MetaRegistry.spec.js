"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _fs = _interopRequireDefault(require("fs"));

var _path = _interopRequireDefault(require("path"));

var _ = require(".");

var _contracts = _interopRequireDefault(require("../test/contracts"));

// Copyright 2017-2020 @polkadot/api-contract authors & contributors
// SPDX-License-Identifier: Apache-2.0
describe('MetaRegistry', () => {
  Object.keys(_contracts.default).forEach(abiName => {
    it(`initializes from a contract ABI (${abiName})`, () => {
      const abi = new _.Abi(_contracts.default[abiName]);

      try {
        const cmpPath = _path.default.join(__dirname, `../test/compare/${abiName}.test.json`);

        if (!_fs.default.existsSync(cmpPath)) {
          _fs.default.writeFileSync(cmpPath, JSON.stringify(abi.registry.metaTypeDefs, null, 2), {
            flag: 'w'
          });
        } // eslint-disable-next-line @typescript-eslint/no-var-requires


        expect(abi.registry.metaTypeDefs).toEqual(require(cmpPath));
      } catch (error) {
        console.error(JSON.stringify(abi.registry.metaTypeDefs));
        throw error;
      }
    });
  });
  it('stores base project as JSON', () => {
    expect(new _.Abi(_contracts.default.ink_dns).json).toEqual(_contracts.default.ink_dns);
  });
});