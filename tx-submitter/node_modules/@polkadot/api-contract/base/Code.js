"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Code = exports.CodeSubmittableResult = void 0;

var _api = require("@polkadot/api");

var _util = require("@polkadot/util");

var _util2 = require("../util");

var _Base = require("./Base");

var _Blueprint = require("./Blueprint");

// Copyright 2017-2020 @polkadot/api-contract authors & contributors
// SPDX-License-Identifier: Apache-2.0
class CodeSubmittableResult extends _api.SubmittableResult {
  constructor(result, blueprint) {
    super(result);
    this.blueprint = void 0;
    this.blueprint = blueprint;
  }

}

exports.CodeSubmittableResult = CodeSubmittableResult;

class Code extends _Base.Base {
  constructor(api, abi, wasm, decorateMethod) {
    super(api, abi, decorateMethod);
    this.code = void 0;
    this.code = (0, _util.isWasm)(this.abi.project.source.wasm) ? this.abi.project.source.wasm : (0, _util.u8aToU8a)(wasm);
    (0, _util.assert)((0, _util.isWasm)(this.code), 'No WASM code provided');
  }
  /**
   * @description Deploy the code bundle, creating a Blueprint.
   */


  createBlueprint() {
    return this.api.tx.contracts.putCode((0, _util.compactAddLength)(this.code)).withResultTransform(result => new CodeSubmittableResult(result, (0, _util2.applyOnEvent)(result, 'CodeStored', ([record]) => new _Blueprint.Blueprint(this.api, this.abi, record.event.data[0], this._decorateMethod))));
  }

}

exports.Code = Code;